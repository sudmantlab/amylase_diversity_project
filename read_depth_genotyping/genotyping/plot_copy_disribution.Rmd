---
title: "Untitled"
output: html_document
date: "2023-02-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r}
library(tidyverse)
t=read.table("./output/genotypes.raw.tsv",header=T,sep="\t")
#install.packages("devtools") 
#devtools::install_github("jakelawlor/PNWColors") 
library(PNWColors)
library(ggplot2)
theme_set(theme_bw())
library(stringr)
library(dplyr)
library(tidyr)
library(Rcpp)

```

```{r}

t %>% mutate(reordered_p2 = case_when(p2 == "AFR" ~ "0_AFR",
                                      p2 == "OCN" ~ "1_OCN",
                                      p2 == "CAS" ~ "2_CAS",
                                      p2 == "WEA" ~ "3_WEA",
                                      p2 == "SA" ~ "",
                                      p2 == "EA" ~ "",
                                      p2 == "AMR" ~ ""
                                      ))


t$p2 = factor(t$p2, levels=c("AFR","OCN","CAS","WEA","SA","EA","AMR"))



```


```{r}





g=ggplot(t %>% filter(name%in% c("amy1_sum","AMY2A","AMY2B")) %>% filter(dataset!="StoneAgeAncient") %>% filter(name == "amy1_sum"))
g=g+geom_point(aes(x=gt,reorder(p1,gt),color=p2),size=.5,alpha=.5,shape="|")+
  stat_summary(aes(x=gt,y=reorder(p1,gt),color=p2),size=.1)+
  theme_bw(base_size=4)+
  facet_wrap(~name,scales = "free")+
  scale_color_manual("",values=pnw_palette("Bay",8))+
  theme(legend.key.size=unit(0.5,"cm"))
  #scale_color_brewer(palette="BuGn")

fn_out = "./output_figures/copy_by_pop_1.pdf"
pdf(fn_out,width=2.5,height=4)
print(g)
dev.off()

g=ggplot(t %>% filter(name%in% c("amy1_sum","AMY2A","AMY2B")) %>% filter(dataset!="StoneAgeAncient") %>% filter(name == "AMY2A"))
g=g+geom_point(aes(x=gt,reorder(p1,gt),color=p2),size=.5,alpha=.5,shape="|")+
  stat_summary(aes(x=gt,y=reorder(p1,gt),color=p2),size=.1)+
  theme_bw(base_size=4)+
  facet_wrap(~name,scales = "free")+
  scale_color_manual("",values=pnw_palette("Bay",8))+
  theme(legend.key.size=unit(0.5,"cm"))
  #scale_color_brewer(palette="BuGn")

fn_out = "./output_figures/copy_by_pop_2A.pdf"
pdf(fn_out,width=2.5,height=4)
print(g)
dev.off()


g=ggplot(t %>% filter(name%in% c("amy1_sum","AMY2A","AMY2B")) %>% filter(dataset!="StoneAgeAncient") %>% filter(name == "AMY2B"))
g=g+geom_point(aes(x=gt,reorder(p1,gt),color=p2),size=.5,alpha=.5,shape="|")+
  stat_summary(aes(x=gt,y=reorder(p1,gt),color=p2),size=.1)+
  theme_bw(base_size=4)+
  facet_wrap(~name,scales = "free")+
  scale_color_manual("",values=pnw_palette("Bay",8))+
  theme(legend.key.size=unit(0.5,"cm"))
  #scale_color_brewer(palette="BuGn")

fn_out = "./output_figures/copy_by_pop_2B.pdf"
pdf(fn_out,width=2.5,height=4)
print(g)
dev.off()



```
```{r}

g=ggplot(t %>% filter(name%in% c("amy1_sum","AMY2A","AMY2B")) %>% filter(dataset!="StoneAgeAncient") %>% filter(name == "AMY2B"))
g=g+geom_point(aes(x=gt,reorder(p1,gt),color=p2),size=.5,alpha=.5,shape="|")+
  stat_summary(aes(x=gt,y=reorder(p1,gt),color=p2),size=.1)+
  theme_bw(base_size=4)+
  facet_wrap(~name,scales = "free")+
  scale_color_manual("",values=pnw_palette("Bay",8))+
  theme(legend.key.size=unit(0.5,"cm"))
  #scale_color_brewer(palette="BuGn")

fn_out = "/Users/petersudmant/Documents/science/sudmantlab/projects/ancient_DNA/amylase/amylase_diversity_project/read_depth_genotyping/genotyping/output_figures/copy_by_pop_2B.pdf"
pdf(fn_out,width=2.5,height=4)
print(g)
dev.off()

```

```{r}
#t %>% filter(name%in% c("amy1_sum","AMY2A","AMY2B")) 
#  %>% filter(dataset!="StoneAgeAncient")
#  %>% spread(name, gt)

t %>% spread(name, gt)


```

```{r}
g=ggplot(t %>% spread(name, gt) %>% filter(dataset!="StoneAgeAncient"))
g=g+geom_point(aes(x=amy1_sum,y=AMY2A,color=p2),size=0.9)+
  #stat_summary(aes(x=gt,y=reorder(p1,gt),color=p2),size=.1)+
  #theme_bw(base_size=4)+
  #facet_wrap(~name,scales = "free")+
  scale_color_manual("",values=pnw_palette("Bay",8))+
  theme(legend.key.size=unit(0.5,"cm"))+
  ylim(-0.25,7.25)+
  xlim(0,21)+
  #scale_color_brewer(palette="BuGn")
 labs(title = "AMY2A vs. AMY1 Copy Number (1KG and HGDP)", x = "AMY1 Summed Copy Number", y = "AMY2A Copy Number")

fn_out = "./output_figures/AMY2A_vs_AMY1_scatterplot.pdf"
pdf(fn_out,width=8,height=6)
print(g)
dev.off()




```














